# 高德地图插件 (AMapPlugin)

Typecho 插件，用于在文章中插入交互式高德地图。

## 功能特性

- ✅ 支持在文章中插入交互式高德地图
- ✅ 支持多个标记点（最多500个）
- ✅ 支持自定义标记文本和图标
- ✅ 支持2D/3D视图模式切换
- ✅ 支持自定义缩放级别（1-18）
- ✅ 支持11种地图主题样式
- ✅ 可视化编辑器界面
- ✅ 响应式设计
- ✅ 自动计算地图中心点
- ✅ 点击标记点显示信息窗口

## 地图主题

插件支持以下11种高德地图主题样式：

1. **标准 (normal)** - 默认主题
2. **幻影黑 (dark)** - 深色主题
3. **月光银 (light)** - 浅色主题
4. **远山黛 (whitesmoke)** - 淡灰色主题
5. **草色青 (fresh)** - 清新绿色主题
6. **雅士灰 (grey)** - 灰色调主题
7. **涂鸦 (graffiti)** - 涂鸦风格主题
8. **马卡龙 (macaron)** - 马卡龙色彩主题
9. **靛青蓝 (blue)** - 蓝色调主题
10. **极夜蓝 (darkblue)** - 深蓝色主题
11. **酱籽 (wine)** - 酒红色主题

## 安装方法

1. 下载插件文件
2. 将 `AMapPlugin` 文件夹上传到 Typecho 的 `/usr/plugins/` 目录
3. 在 Typecho 后台插件管理中启用插件
4. 在插件设置中配置高德地图API Key

## 配置说明

在插件设置面板中可以配置：

- **高德地图API Key**: 需要在[高德开放平台](https://lbs.amap.com/)申请【Web服务】Key
- **默认缩放级别**: 地图默认缩放级别，范围1-18，数字越大缩放级别越高
- **默认视图模式**: 2D或3D模式
- **默认地图主题**: 选择默认的地图主题样式
- **最大标记点数量**: 单次可添加的最大标记点数量（默认500）

## 使用方法

### 在文章中使用

#### 方法一：使用可视化编辑器

1. 在文章编辑器工具栏中点击地图图标按钮 (🌍)
2. 在弹出的对话框中配置地图：
   - 选择视图模式（2D/3D）
   - 选择地图主题
   - 设置缩放级别（1-18）
3. 添加标记点：
   - 输入经度和纬度
   - 输入标记文本（可选）
   - 输入图标URL（可选，建议32x32像素的PNG或JPG图片）
   - 点击"+ 添加标记点"可添加更多标记点
4. 点击"确认插入"将地图插入到文章中

#### 方法二：使用短代码

也可以手动输入短代码：

```
[amap view=2D zoom=15 theme=normal]
marker1="116.397428,39.90923,北京,"
marker2="121.473701,31.230416,上海,"
[/amap]
```

参数说明：
- `view`: 视图模式（2D/3D）
- `zoom`: 缩放级别（1-18）
- `theme`: 地图主题（normal/dark/light/whitesmoke/fresh/grey/graffiti/macaron/blue/darkblue/wine）
- `marker1`, `marker2`, ...: 标记点参数，格式为"经度,纬度,标记文本,图标URL"

注意：
- 标记文本和图标URL是可选的
- 如果标记文本或图标URL包含特殊字符，系统会自动进行编码处理
- 至少需要提供一个有效的标记点（包含经度和纬度）

## 获取经纬度

使用[高德地图经纬度选择工具](https://lbs.amap.com/tools/picker)获取准确的经纬度坐标。

## 高级功能

### 自定义图标

您可以为每个标记点指定自定义图标：

```
[amap view=2D zoom=15 theme=normal]
marker1="116.397428,39.90923,北京,https://example.com/icon.png"
[/amap]
```

图标要求：
- 支持PNG、JPG格式
- 建议尺寸：32x32像素
- 图标加载失败时会自动回退到默认图标

### 3D视图模式

使用3D视图模式可以获得更好的视觉效果：

```
[amap view=3D zoom=15 theme=dark]
marker1="116.397428,39.90923,北京,"
[/amap]
```

3D模式下地图会自动设置45度倾斜角度。

## 常见问题

### Q: 地图不显示怎么办？
A: 请检查以下几点：
1. 确保已正确配置高德地图API Key
2. 检查浏览器控制台是否有错误信息
3. 确认网络连接正常，能够访问高德地图API

### Q: 标记点位置不准确？
A: 请确保使用的是高德地图坐标系（GCJ-02），而不是其他坐标系。

### Q: 自定义图标不显示？
A: 请检查：
1. 图标URL是否正确且可访问
2. 图标格式是否为PNG或JPG
3. 图标尺寸是否过大（建议不超过64x64像素）

## 更新日志

### v1.2.0 (2024-01-XX)
- 新增11种地图主题样式支持
- 优化编辑器界面，添加主题选择下拉菜单
- 支持在短代码中使用theme参数
- 改进图标加载机制，添加错误处理
- 优化地图中心点计算逻辑

### v1.1.0
- 支持多个标记点（最多500个）
- 支持自定义标记图标
- 优化编辑器界面
- 添加标记点删除功能

### v1.0.0
- 初始版本发布
- 支持基本地图插入功能

## 技术实现

插件使用高德地图JavaScript API v2.0实现地图功能，主要特性：

- 自动计算地图中心点基于所有标记点的平均位置
- 支持响应式设计，地图容器宽度为100%
- 使用事件委托处理动态添加的标记点
- 图标预加载机制，确保自定义图标正确显示
- 支持键盘快捷键操作（ESC关闭对话框，回车键导航）

## 作者

王叨叨 - https://wangdaodao.com/